(function(g){g.registerPlugin(bkClass.extend({construct:function(a){"allow"!==a.options.pasteMode&&(this.ne=a,a.addEvent("add",this.add.closureListener(this)),this.pasteCache="")},add:function(a){this.elm=a.elm;this.elm.addEvent("paste",this.initPasteClean.closureListener(this))},cleanup:function(a){},initPasteClean:function(){this.pasteCache=this.elm.innerHTML;setTimeout(this.pasteClean.closure(this),100)},pasteClean:function(){var a="",b="",d=this.elm.innerHTML,c=0,f=0,c="",e;this.ne.fireEvent("get",
this);for(c=0;d.charAt(c)===this.pasteCache.charAt(c);c++)a+=this.pasteCache.charAt(c);for(e=c;0<=e;e--)if("<"==this.pasteCache.charAt(e)){c=e;a=this.pasteCache.substring(0,c);break}else if(">"===this.pasteCache.charAt(e))break;d=this.reverse(d);this.pasteCache=this.reverse(this.pasteCache);for(f=0;d.charAt(f)==this.pasteCache.charAt(f);f++)b+=this.pasteCache.charAt(f);for(e=f;0<=e;e--)if(">"==this.pasteCache.charAt(e)){f=e;b=this.pasteCache.substring(0,f);break}else if("<"==this.pasteCache.charAt(e))break;
b=this.reverse(b);if(c==d.length-f)return!1;d=this.reverse(d);c=d.substring(c,d.length-f);c=this.cleanPaste(c);this.content=a+c+b;this.ne.fireEvent("set",this);this.elm.innerHTML=this.content},reverse:function(a){var b="",d;for(d=a.length-1;0<=d;d--)b+=a.charAt(d);return b},cleanPaste:function(a){var b;b||(b=document.createElement("div"));b.innerHTML=a;return b.innerText}}))})(nicEditors);
